<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workshop Editor Demo - workshopsAI CMS</title>
    <script type="module" src="../src/index.ts"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f9fafb;
        }

        .demo-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .demo-header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .demo-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #111827;
            margin: 0;
        }

        .demo-info {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .editor-wrapper {
            flex: 1;
            overflow: hidden;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-size: 1.125rem;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <header class="demo-header">
            <div>
                <h1 class="demo-title">üõ†Ô∏è Workshop Editor Demo</h1>
                <p class="demo-info">Interactive workshop creation tool for sociologists</p>
            </div>
            <div class="demo-info">
                <p>Features: Drag & Drop Sessions ‚Ä¢ File Uploads ‚Ä¢ Live Preview ‚Ä¢ Templates</p>
            </div>
        </header>

        <main class="editor-wrapper">
            <div id="loading" class="loading">
            Loading workshop editor...
        </div>

            <!-- Workshop Editor Component -->
            <workshop-editor
                id="workshopEditor"
                style="display: none; height: 100%;"
                workshop-id="demo-workshop"
            ></workshop-editor>
        </main>
    </div>

    <script type="module">
        import { WorkshopEditor } from '../src/components/workshop/WorkshopEditor.js';

        // Initialize the workshop editor when the page loads
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Hide loading indicator
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.style.display = 'none';
                }

                // Show workshop editor
                const editor = document.getElementById('workshopEditor');
                if (editor) {
                    editor.style.display = 'block';

                    // Set up event listeners for the workshop editor
                    editor.addEventListener('workshop-change', (event) => {
                        console.log('Workshop changed:', event.detail);
                    });

                    editor.addEventListener('sessions-change', (event) => {
                        console.log('Sessions changed:', event.detail);
                    });

                    editor.addEventListener('materials-change', (event) => {
                        console.log('Materials changed:', event.detail);
                    });

                    editor.addEventListener('template-selected', (event) => {
                        console.log('Template selected:', event.detail);

                        // You could automatically apply the template here
                        const template = event.detail.template;
                        if (template && confirm(`Apply template "${template.name.en}" to this workshop?`)) {
                            // Apply template logic would go here
                            console.log('Applying template:', template);
                        }
                    });

                    // Add some demo data if needed
                    await addDemoData(editor);
                }
            } catch (error) {
                console.error('Failed to initialize workshop editor:', error);

                const loading = document.getElementById('loading');
                if (loading) {
                    loading.innerHTML = `
                        <div style="text-align: center; color: #ef4444;">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">‚ùå</div>
                            <div>Failed to load workshop editor</div>
                            <div style="font-size: 0.875rem; margin-top: 0.5rem;">Please check the console for details</div>
                        </div>
                    `;
                }
            }
        });

        // Add demo data to the workshop editor
        async function addDemoData(editor) {
            // Wait for the editor to be fully initialized
            await new Promise(resolve => setTimeout(resolve, 1000));

            try {
                // You can programmatically set workshop data here
                console.log('Workshop editor initialized successfully');

                // Example: Show a welcome notification
                if (editor.showSuccess) {
                    editor.showSuccess('Workshop editor ready! Start creating your workshop.');
                }
            } catch (error) {
                console.error('Failed to add demo data:', error);
            }
        }

        // Handle keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            // Ctrl/Cmd + S to save
            if ((event.ctrlKey || event.metaKey) && event.key === 's') {
                event.preventDefault();
                const editor = document.getElementById('workshopEditor');
                if (editor && editor.saveWorkshop) {
                    editor.saveWorkshop().catch(console.error);
                }
            }

            // Ctrl/Cmd + P to preview
            if ((event.ctrlKey || event.metaKey) && event.key === 'p') {
                event.preventDefault();
                const editor = document.getElementById('workshopEditor');
                if (editor && editor.togglePreview) {
                    editor.togglePreview();
                }
            }

            // Ctrl/Cmd + N for new workshop
            if ((event.ctrlKey || event.metaKey) && event.key === 'n') {
                event.preventDefault();
                if (confirm('Create a new workshop? Any unsaved changes will be lost.')) {
                    window.location.reload();
                }
            }
        });

        // Global error handler
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
        });

        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
        });
    </script>
</body>
</html>